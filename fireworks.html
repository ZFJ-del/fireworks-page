<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šç­å¿«ä¹çƒŸèŠ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Microsoft YaHei', sans-serif;
            height: 100vh;
            color: white;
            touch-action: manipulation;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .title {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            width: 100%;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #ff0080;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
        }

        /* æ€§èƒ½ç›‘æ§é¢æ¿ */
        .performance-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #00ff00;
        }

        /* åˆ†äº«æŒ‰é’® - å³ä¸Šè§’ */
        .share-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: linear-gradient(45deg, #ff0080, #ff8c00);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(255, 0, 128, 0.3);
        }

        .share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 0, 128, 0.5);
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .share-btn {
                top: 15px;
                right: 15px;
                padding: 8px 16px;
                font-size: 0.9em;
            }

            h1 {
                font-size: 2em;
            }

            .subtitle {
                font-size: 1em;
            }

            .performance-panel {
                display: none; /* ç§»åŠ¨ç«¯éšè—æ€§èƒ½é¢æ¿ */
            }
        }
    </style>
</head>
<body>
<div class="title">
    <h1>ğŸ† ä¸Šç­å¿«ä¹çƒŸèŠ± ğŸ†</h1>
    <p class="subtitle">ç‚¹å‡»å±å¹•å‘å°„å¸¦æœ‰ç¥ç¦æ–‡å­—çš„çƒŸèŠ±</p>
</div>

<!-- æ€§èƒ½ç›‘æ§é¢æ¿ -->
<div class="performance-panel" id="performancePanel">
    <div>ç²’å­æ•°: <span id="particleCount">0</span></div>
    <div>FPS: <span id="fps">0</span></div>
    <div>çŠ¶æ€: <span id="performanceStatus">è‰¯å¥½</span></div>
</div>

<!-- åˆ†äº«æŒ‰é’® -->
<button class="share-btn" onclick="sharePage()">åˆ†äº«</button>

<canvas id="fireworks"></canvas>

<script>
    // æ€§èƒ½ä¼˜åŒ–é…ç½®
    const PERFORMANCE_CONFIG = {
        MAX_PARTICLES: 800,           // æœ€å¤§ç²’å­æ•°é™åˆ¶
        MAX_FIREWORKS: 20,             // æœ€å¤§åŒæ—¶å­˜åœ¨çš„çƒŸèŠ±æ•°
        AUTO_FIRE_RATE: 0.015,        // è‡ªåŠ¨å‘å°„é¢‘ç‡ï¼ˆé™ä½é¢‘ç‡ï¼‰
        PARTICLE_COUNT: 30,           // æ¯ä¸ªçƒŸèŠ±çš„ç²’å­æ•°ï¼ˆå‡å°‘ï¼‰
        TEXT_PARTICLE_COUNT: 6,       // æ–‡å­—ç²’å­æ•°
        TRAIL_LENGTH: 3,              // å°¾è¿¹é•¿åº¦
        FPS_LIMIT: 60,                // å¸§ç‡é™åˆ¶
        PERFORMANCE_MODE: false       // æ€§èƒ½æ¨¡å¼å¼€å…³
    };

    // è·å–Canvasä¸Šä¸‹æ–‡
    const canvas = document.getElementById('fireworks');
    const ctx = canvas.getContext('2d');

    // è®¾ç½®Canvaså¤§å°ä¸ºçª—å£å¤§å°
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // æ€§èƒ½ç›‘æ§å˜é‡
    let frameCount = 0;
    let lastTime = performance.now();
    let fps = 0;

    // çƒŸèŠ±ç²’å­æ•°ç»„
    const fireworks = [];
    const particles = [];
    const textParticles = [];

    // é¢œè‰²æ•°ç»„
    const colors = ['#ff0080', '#ff8c00', '#00ff88', '#0088ff', '#ff00ff', '#ffff00', '#00ffff'];

    // ç¥ç¦æ–‡å­—æ•°ç»„
    const blessingTexts = ['ä¸Š', 'ç­', 'å¿«', 'ä¹'];

    // æ–‡å­—ç²’å­ç±» - ä¼˜åŒ–ç‰ˆæœ¬
    class TextParticle {
        constructor(x, y, vx, vy, color, size, text) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.color = color;
            this.originalSize = size;
            this.size = size;
            this.text = text;
            this.alpha = 1;
            this.decay = 0.96; // å‡æ…¢è¡°å‡
            this.gravity = 0.06; // å‡å°é‡åŠ›
            this.rotation = Math.random() * Math.PI * 2;
            this.rotationSpeed = (Math.random() - 0.5) * 0.06;
            this.life = 120; // å»¶é•¿ç”Ÿå‘½å‘¨æœŸ
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.vy += this.gravity;
            this.vx *= this.decay;
            this.vy *= this.decay;
            this.life -= 1;
            this.alpha = Math.max(0, this.life / 120);
            this.size = this.originalSize * (this.life / 120);
            this.rotation += this.rotationSpeed;

            return this.life > 0;
        }

        draw() {
            if (this.alpha <= 0) return;

            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.fillStyle = this.color;
            ctx.font = `bold ${Math.max(8, this.size)}px Microsoft YaHei`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.translate(this.x, this.y);
            ctx.rotate(this.rotation);

            // æ·»åŠ å‘å…‰æ•ˆæœ
            ctx.shadowColor = this.color;
            ctx.shadowBlur = 8;
            ctx.fillText(this.text, 0, 0);
            ctx.restore();
        }
    }

    // çƒŸèŠ±ç±» - æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬
    class Firework {
        constructor(x, y, targetText = null) {
            this.x = x;
            this.y = y;
            this.targetY = Math.random() * canvas.height * 0.4;
            this.speed = 4 + Math.random() * 2; // ç¨å¾®å˜åŒ–çš„é€Ÿåº¦
            this.color = colors[Math.floor(Math.random() * colors.length)];
            this.trail = [];
            this.exploded = false;
            this.text = targetText || blessingTexts[Math.floor(Math.random() * blessingTexts.length)];
        }

        update() {
            if (!this.exploded) {
                this.y -= this.speed;

                // ä¼˜åŒ–å°¾è¿¹ - å‡å°‘ç‚¹æ•°é‡
                this.trail.push({x: this.x, y: this.y});
                if (this.trail.length > PERFORMANCE_CONFIG.TRAIL_LENGTH) {
                    this.trail.shift();
                }

                if (this.y <= this.targetY) {
                    this.explode();
                }
            }
        }

        explode() {
            this.exploded = true;

            // æ£€æŸ¥ç²’å­æ•°é‡é™åˆ¶
            if (particles.length + PERFORMANCE_CONFIG.PARTICLE_COUNT > PERFORMANCE_CONFIG.MAX_PARTICLES) {
                return; // ç²’å­è¿‡å¤šï¼Œä¸çˆ†ç‚¸
            }

            // åˆ›å»ºæ™®é€šç²’å­ - å‡å°‘æ•°é‡
            for (let i = 0; i < PERFORMANCE_CONFIG.PARTICLE_COUNT; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = 1.5 + Math.random() * 2;
                const size = 0.5 + Math.random() * 1.5;
                const decay = 0.92 + Math.random() * 0.04;

                particles.push(new Particle(
                    this.x, this.y,
                    Math.cos(angle) * speed,
                    Math.sin(angle) * speed,
                    this.color,
                    size,
                    decay
                ));
            }

            // åˆ›å»ºæ–‡å­—ç²’å­
            for (let i = 0; i < PERFORMANCE_CONFIG.TEXT_PARTICLE_COUNT; i++) {
                const angle = (i / PERFORMANCE_CONFIG.TEXT_PARTICLE_COUNT) * Math.PI * 2;
                const speed = 0.8 + Math.random() * 1.2;
                const size = 20 + Math.random() * 10;

                textParticles.push(new TextParticle(
                    this.x, this.y,
                    Math.cos(angle) * speed,
                    Math.sin(angle) * speed,
                    this.color,
                    size,
                    this.text
                ));
            }
        }

        draw() {
            if (!this.exploded && this.trail.length > 1) {
                // ç»˜åˆ¶çƒŸèŠ±å°¾è¿¹ - ä¼˜åŒ–ç»˜åˆ¶æ€§èƒ½
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(this.trail[0].x, this.trail[0].y);
                for (let i = 1; i < this.trail.length; i++) {
                    ctx.lineTo(this.trail[i].x, this.trail[i].y);
                }
                ctx.stroke();

                // ç»˜åˆ¶çƒŸèŠ±å¤´
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }
    }

    // æ™®é€šç²’å­ç±» - ä¼˜åŒ–ç‰ˆæœ¬
    class Particle {
        constructor(x, y, vx, vy, color, size, decay) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.color = color;
            this.size = size;
            this.decay = decay;
            this.alpha = 1;
            this.gravity = 0.08;
            this.life = 100;
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.vy += this.gravity;
            this.vx *= this.decay;
            this.vy *= this.decay;
            this.life -= 2; // åŠ å¿«æ¶ˆå¤±
            this.alpha = Math.max(0, this.life / 100);
            this.size *= 0.98;

            return this.life > 0 && this.alpha > 0;
        }

        draw() {
            if (this.alpha <= 0) return;

            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
    }

    // æ€§èƒ½ç›‘æ§å‡½æ•°
    function updatePerformanceMonitor() {
        frameCount++;
        const currentTime = performance.now();
        if (currentTime - lastTime >= 1000) {
            fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
            frameCount = 0;
            lastTime = currentTime;

            // æ›´æ–°æ€§èƒ½é¢æ¿
            document.getElementById('particleCount').textContent =
                particles.length + textParticles.length;
            document.getElementById('fps').textContent = fps;

            // æ€§èƒ½çŠ¶æ€æç¤º
            const totalParticles = particles.length + textParticles.length;
            let status = 'è‰¯å¥½';
            let color = '#00ff00';

            if (fps < 30) {
                status = 'å¡é¡¿';
                color = '#ff0000';
            } else if (fps < 50) {
                status = 'ä¸€èˆ¬';
                color = '#ffff00';
            }

            if (totalParticles > PERFORMANCE_CONFIG.MAX_PARTICLES * 0.8) {
                status = 'ç²’å­è¿‡å¤š';
                color = '#ff0000';
            }

            document.getElementById('performanceStatus').textContent = status;
            document.getElementById('performanceStatus').style.color = color;
        }
    }

    // ç²’å­æ•°é‡æ§åˆ¶å‡½æ•°
    function manageParticleCount() {
        // å¦‚æœç²’å­è¿‡å¤šï¼Œæ¸…ç†æœ€è€çš„éƒ¨åˆ†ç²’å­
        const maxParticles = PERFORMANCE_CONFIG.MAX_PARTICLES;
        const totalParticles = particles.length + textParticles.length;

        if (totalParticles > maxParticles) {
            // æ¸…ç†æ™®é€šç²’å­
            const particlesToRemove = Math.min(particles.length, totalParticles - maxParticles * 0.7);
            particles.splice(0, particlesToRemove);

            // æ¸…ç†æ–‡å­—ç²’å­
            const textParticlesToRemove = Math.min(textParticles.length, totalParticles - maxParticles * 0.7);
            textParticles.splice(0, textParticlesToRemove);
        }
    }

    // ä¼˜åŒ–åçš„åŠ¨ç”»å¾ªç¯
    function animate(currentTime) {
        // æ€§èƒ½ç›‘æ§
        updatePerformanceMonitor();

        // ç²’å­æ•°é‡æ§åˆ¶
        manageParticleCount();

        // ä½¿ç”¨æ›´é«˜æ•ˆçš„æ¸…å±æ–¹å¼
        ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; // å¢åŠ é€æ˜åº¦ï¼Œå‡å°‘æ‹–å°¾
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // æ§åˆ¶è‡ªåŠ¨å‘å°„é¢‘ç‡ - æ ¹æ®æ€§èƒ½åŠ¨æ€è°ƒæ•´
        let autoFireRate = PERFORMANCE_CONFIG.AUTO_FIRE_RATE;
        if (fps < 40) autoFireRate *= 0.5;
        if (fps < 25) autoFireRate = 0; // ä¸¥é‡å¡é¡¿æ—¶åœæ­¢è‡ªåŠ¨å‘å°„

        // éšæœºç”Ÿæˆæ–°çƒŸèŠ±ï¼ˆå¸¦æ€§èƒ½æ£€æŸ¥ï¼‰
        if (Math.random() < autoFireRate && fireworks.length < PERFORMANCE_CONFIG.MAX_FIREWORKS) {
            const textIndex = Math.floor(Math.random() * blessingTexts.length);
            fireworks.push(new Firework(
                Math.random() * canvas.width,
                canvas.height,
                blessingTexts[textIndex]
            ));
        }

        // æ‰¹é‡æ›´æ–°å’Œç»˜åˆ¶ - å‡å°‘å‡½æ•°è°ƒç”¨
        updateAndDrawFireworks();
        updateAndDrawParticles();
        updateAndDrawTextParticles();

        requestAnimationFrame(animate);
    }

    // æ‰¹é‡æ›´æ–°çƒŸèŠ±
    function updateAndDrawFireworks() {
        for (let i = fireworks.length - 1; i >= 0; i--) {
            fireworks[i].update();
            fireworks[i].draw();

            if (fireworks[i].exploded) {
                fireworks.splice(i, 1);
            }
        }
    }

    // æ‰¹é‡æ›´æ–°æ™®é€šç²’å­
    function updateAndDrawParticles() {
        for (let i = particles.length - 1; i >= 0; i--) {
            if (!particles[i].update()) {
                particles.splice(i, 1);
            } else {
                particles[i].draw();
            }
        }
    }

    // æ‰¹é‡æ›´æ–°æ–‡å­—ç²’å­
    function updateAndDrawTextParticles() {
        for (let i = textParticles.length - 1; i >= 0; i--) {
            if (!textParticles[i].update()) {
                textParticles.splice(i, 1);
            } else {
                textParticles[i].draw();
            }
        }
    }

    // ä¼˜åŒ–ç‚¹å‡»äº‹ä»¶ - é˜²æŠ–å’Œæ€§èƒ½æ£€æŸ¥
    let lastClickTime = 0;
    const CLICK_COOLDOWN = 500; // 500æ¯«ç§’å†·å´

    canvas.addEventListener('click', function(e) {
        const currentTime = Date.now();
        if (currentTime - lastClickTime < CLICK_COOLDOWN) return;
        lastClickTime = currentTime;

        // æ€§èƒ½æ£€æŸ¥ï¼šå¦‚æœç²’å­è¿‡å¤šï¼Œå‡å°‘å‘å°„æ•°é‡
        const totalParticles = particles.length + textParticles.length;
        const fireworkCount = totalParticles > PERFORMANCE_CONFIG.MAX_PARTICLES * 0.5 ? 2 : 4;

        for (let i = 0; i < fireworkCount; i++) {
            setTimeout(() => {
                if (fireworks.length < PERFORMANCE_CONFIG.MAX_FIREWORKS) {
                    fireworks.push(new Firework(
                        e.clientX + (Math.random() - 0.5) * 200,
                        canvas.height,
                        blessingTexts[i % blessingTexts.length]
                    ));
                }
            }, i * 400);
        }
    });

    // è§¦æ‘¸æ”¯æŒï¼ˆå¸¦æ€§èƒ½æ£€æŸ¥ï¼‰
    canvas.addEventListener('touchstart', function(e) {
        e.preventDefault();
        const touch = e.touches[0];
        const currentTime = Date.now();

        if (currentTime - lastClickTime < CLICK_COOLDOWN) return;
        lastClickTime = currentTime;

        const totalParticles = particles.length + textParticles.length;
        const fireworkCount = totalParticles > PERFORMANCE_CONFIG.MAX_PARTICLES * 0.5 ? 2 : 3;

        for (let i = 0; i < fireworkCount; i++) {
            setTimeout(() => {
                if (fireworks.length < PERFORMANCE_CONFIG.MAX_FIREWORKS) {
                    fireworks.push(new Firework(
                        touch.clientX + (Math.random() - 0.5) * 150,
                        canvas.height,
                        blessingTexts[i % blessingTexts.length]
                    ));
                }
            }, i * 400);
        }
    });

    // é”®ç›˜æ”¯æŒ
    document.addEventListener('keydown', function(e) {
        if (e.code === 'Space') {
            e.preventDefault();
            const totalParticles = particles.length + textParticles.length;
            const fireworkCount = totalParticles > PERFORMANCE_CONFIG.MAX_PARTICLES * 0.6 ? 1 : 2;

            for (let i = 0; i < fireworkCount; i++) {
                setTimeout(() => {
                    if (fireworks.length < PERFORMANCE_CONFIG.MAX_FIREWORKS) {
                        fireworks.push(new Firework(
                            Math.random() * canvas.width,
                            canvas.height,
                            blessingTexts[Math.floor(Math.random() * blessingTexts.length)]
                        ));
                    }
                }, i * 500);
            }
        }
    });

    // åˆ†äº«åŠŸèƒ½
    function sharePage() {
        if (navigator.share) {
            navigator.share({
                title: 'é«˜æ€§èƒ½ä¸Šç­å¿«ä¹çƒŸèŠ±ç§€',
                text: 'ç‚¹å‡»è§‚çœ‹æµç•…çš„"ä¸Šç­å¿«ä¹"çƒŸèŠ±æ•ˆæœï¼',
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(window.location.href);
            alert('é“¾æ¥å·²å¤åˆ¶ï¼Œå¯ä»¥åˆ†äº«ç»™æœ‹å‹äº†ï¼');
        }
    }

    // å“åº”çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', function() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    // å¼€å§‹åŠ¨ç”»
    animate();

    // æ·»åŠ æ€§èƒ½æç¤º
    console.log('ğŸ† é«˜æ€§èƒ½ä¸Šç­å¿«ä¹çƒŸèŠ±å·²åŠ è½½ï¼');
    console.log('ğŸ’¡ æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§ï¼š');
    console.log('   - ç²’å­æ•°é‡é™åˆ¶ï¼š' + PERFORMANCE_CONFIG.MAX_PARTICLES);
    console.log('   - è‡ªåŠ¨æ€§èƒ½è°ƒèŠ‚');
    console.log('   - ç‚¹å‡»é˜²æŠ–ä¿æŠ¤');
    console.log('   - åŠ¨æ€å‘å°„é¢‘ç‡');
</script>
</body>
</html>

